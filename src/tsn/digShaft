os.loadAPI("turtleUtils")

--    Level 63      Level 62-13
--  |------|---|    |----|-----|
--  |   C  |   |    |    |     |
--  |------|---|    |----|-----|
--  | Tu/W | E |    |  S | R/T |
--  |------|---|    |----|-----|
--  |      |   |    |    |  L  |
--  |------|---|    |----|-----|
--  C  = Chest
--  W  = Wood Pipe
--  E  = Redstone Engine
--  Tu = Turtle Starting Position

--  S  = Stone Pipe
--  Tu = Turtle Shaft
--  T  = Torches
--  L  = Ladder

local args={...};
local z = args[1];

-- start while turtle facing East to place Engine
local function prepareTopOfShaft()
    selectWithOverflow(redstoneEngineSlot);
    place(forward);
    turn(left);
    selectWithOverflow(smallChestSlot);
    place(forward);
    moveWithDig(down);
    selectWithOverflow(woodenPipeSlot);
    place(up);
end;

local function digShaftLayer()
    replace(forward, wallFiller1Slot, false);
    turn(left);
    replace(forward, wallFiller1Slot, false);
    turn(left);
    replace(forward, wallFiller1Slot, false);
    turn(left);

    moveWithDig(forward)
    replace(forward, wallFiller1Slot, false);
    turn(left);
    replace(forward, wallFiller1Slot, false);
    turn(right, 2);
    moveWithDig(forward)
    replace(forward, wallFiller1Slot, false);
    turn(right);
    replace(forward, wallFiller1Slot, false);
    turn(right, 2);
    replace(forward, wallFiller1Slot, false);
end;

local function prepareShaftLayer()
    turn(right);
    move(back);
    place(forward, ladderSlot);
    turn(left);
    move(back);
    place(forward, redWireSlot);
    if (darkness >= 6) and (place(forward, torchSlot) == blockPlaced) then
        darkness = 0;
    end
    turn(left);
    moveWithDig(down);
    place(up, stonePipeSlot);
end;

local function prepareBottomOfShaft()
    for i=1,3 do
        replace(forward, wallFiller1Slot, false);
        turn(left);
        replace(forward, wallFiller1Slot, false);
        turn(left);

        moveWithDig(forward);
        turn(right);
    end;
    replace(forward, wallFiller1Slot, false);
    turn(left);
    replace(forward, wallFiller1Slot, false);
    turn(left);
    turn(left);
    place(forward, ladderSlot, false);
    turn(left);
    move(back);
    place(forward, redstoneTorchSlot, false);
    turn(left);
    move(back);
    place(forward, smallChestSlot, false);
end;

local function mineShaft()
    prepareTopOfShaft();

    for i = 1,(z-1) do
        digShaftLayer();
        prepareShaftLayer();
        refuel()
    end;

    prepareBottomOfShaft();
end;

mineShaft();