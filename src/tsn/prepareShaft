-- To avoid dealing with namespaces and imported scripts not
-- being able to access local variables, I've decided to inject
-- the source code when it's loaded on the filesystem.
--INJECT/turtleUtils


-- START OF LOCAL SCRIPT
SMALL_CHEST_SLOT = 2; -- 2 stack
REDSTONE_ENGINE_SLOT = 3; -- 1 stack
WOODEN_PIPE_SLOT = 4; -- 1 stack
STONE_PIPE_SLOT = 5; -- 64 stack
REDWIRE_SLOT = 6; -- 64 stack
LADDER_SLOT = 7; -- 64 stack
REDSTONE_TORCH_SLOT = 8; -- 1 stack
TORCH_SLOT = 9; -- 10 stack

local args={...};
local height = args[1];
local overflow = true;

-- start while turtle facing East to place Engine
function prepareTopOfShaft()
    placeItem(forward, SMALL_CHEST_SLOT);
    move(back);
    placeItem(forward, WOODEN_PIPE_SLOT);
    turn(right);
    move(forward);
    turn(left);
    placeItem(forward, REDSTONE_ENGINE_SLOT);

    move(down);
    turn(left);
    move(forward);
    turn(right);
    move(forward);
    dig(forward);
    placeItem(forward, STONE_PIPE_SLOT, overflow);
    move(back);
    turn(right);
end;

function prepareShaftLayer()
    turn(left);
    move(forward);
    turn(left);
    move(back);

    placeItem(forward, STONE_PIPE_SLOT, overflow);
    turn(right);
    move(back);
    placeItem(forward, REDWIRE_SLOT);
    turn(right);
    move(back);
    placeItem(forward, LADDER_SLOT, overflow);
    move(down);
    placeLight(TORCH_SLOT);
end;

function prepareBottomOfShaft()
    turn(left);
    move(forward);
    turn(left);
    move(back);

    placeItem(forward, SMALL_CHEST_SLOT);
    turn(right);
    move(back);
    placeItem(forward, REDSTONE_TORCH_SLOT);
    turn(right);
    move(back);
    placeItem(forward, LADDER_SLOT, overflow);
    move(down);
    placeLight(TORCH_SLOT);
end;

function prepareShaft(height)
    prepareTopOfShaft();
    for i=1,height do
        prepareShaftLayer();
    end;
    prepareBottomOfShaft();
end;

if (height == nil or height=="") then
    fs.delete(logFileName);
    print ("What is the height of the shaft? (X - 13 is normal)");
    height = io.read();
    height = tonumber(height);
end;
prepareShaft(height);