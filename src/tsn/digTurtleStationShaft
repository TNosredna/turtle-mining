torchPos = 13;
wallFiller4Pos = 14;
ladderPos = 15;
fuelPos = 16;
stonePipePos = 11;
largeChestPos = 8;

function moveForward()
    repeat
        turtle.dig();
        until turtle.forward()
end

function mineUp()
    repeat
        turtle.digUp()
        until turtle.up()
end

function refuel()
    if turtle.getFuelLevel() <= 5 then
        turtle.select(fuelPos);
        turtle.refuel(1);
    end
end

function selectLadder()
    turtle.select(ladderPos)
    if turtle.getItemCount(ladderPos) == 1 then
        turtle.select(1)
        while not turtle.compareTo(ladderPos) do
            for i = 1, 12 do
                turtle.select(i)
            end
        end
    end
end

function selectStonePipe()
    turtle.select(stonePipePos)
    if turtle.getItemCount(stonePipePos) == 1 then
        turtle.select(1)
        while not turtle.compareTo(stonePipePos) do
            for i = 1, 12 do
                turtle.select(i)
            end
        end
    end
end

function selectDirt()
    turtle.select(wallFiller4Pos)
    if turtle.getItemCount(wallFiller4Pos) == 1 then
        turtle.select(1)
        while not turtle.compareTo(wallFiller4Pos) do
            for i = 1, 12 do
                turtle.select(i)
            end
        end
    end
end

function placeLadder()
    selectLadder()
    if not turtle.place() then
        selectDirt()
        moveForward()
        turtle.place()
        turtle.back()
        selectLadder()
        if not turtle.place() then
            return false
        end
    end
end

function placeStonePipe()
    selectStonePipe();
    if not turtle.place() then
        selectDirt();
        moveForward();
        turtle.place()
        turtle.back()
        selectStonePipe()
        if not turtle.place() then
            return false
        end
    end
end

glow = 0;
function placeTorch()
    turtle.select(torchPos)
    if not turtle.place() then
        selectDirt()
        moveForward()
        turtle.place()
        turtle.back()
        turtle.select(torchPos)
        if not turtle.place() then
            return false
        end
    end
    glow = glow - glow;
end

local args={... };
z = args[1];

turtle.select(largeChestPos);
turtle.turnRight();
turtle.turnRight();
turtle.place();
for i = 1, z do
    turtle.digDown();
    turtle.down();
    glow = glow + 1
    turtle.dig();
    placeStonePipe();
    turtle.turnLeft();
    if glow >= 6 then
        turtle.dig();
        placeTorch();
    end
    turtle.turnLeft();
    if not placeLadder() then
        --break
    end
    refuel()
end
